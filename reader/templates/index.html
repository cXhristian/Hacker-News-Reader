{% extends "base.html" %}
{% load tags %}
{% load query %}
{% block navbar_button %}
<a class="btn btn-navbar" data-toggle="collapse" data-target=".sidebar-collapse">
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
</a>
{% endblock %}
{% block container %}
<div class="row">
	<div class="col-sm-3">
		<div class="sidebar-container">
			<ul class="hn-sidebar nav sidebar-collapse">
				<form class="form-inline-reverse">
					<div class="form-group">
						<div class="dropdown">
							<button class="btn dropdown-toggle" type="button" data-toggle="dropdown">
								Sorting
								<span class="caret"></span>
							</button>
							<ul class="dropdown-menu">
								<li class="{% active '(^/$)' %}"><a href="/">Frontpage</a></li>
								<li class="{% active '^/newest' %}"><a href="/newest">Newest</a></li>
								<li class="{% active '^/self' %}"><a href="/self">Selfpost</a>
									<ul>
								<li class="{% active '^/ask' %}"><a href="/ask">Ask HN</a></li>
									</ul>
								</li>
								<li class="{% active '^/show' %}"><a href="/show">Show HN</a></li>
								<li class="{% active '^/poll' %}"><a href="/poll">Poll</a></li>
								<li class="{% active '^/best' %}"><a href="/best">Best</a></li>
								<li class="{% active '^/newest' %}"><a href="/newest">Newest</a></li>
							</ul>
						</div>
					</div>
					<div class="form-group">
						<label>Score over</label>
						<select class="form-control" name="score">
							{% for n in '0,50,75,100'|split:',' %}
							<option value="{{ n }}" {% active_score n %}>
								{% if n == '0' %}Show All {% else %}{{ n }}{% endif %}
							</option>
							{% endfor %}
						</select>
					</div>
					<div class="form-group">
						<label>Show per page</label>
						<select class="form-control" name="limit">
							{% for n in '25,50,100'|split:',' %}
							<option value="{{ n }}" {% active_limit n %}>
								{{ n }}
							</option>
							{% endfor %}
						</select>
					</div>
					<button class="btn" type="submit">Apply filters</button>
				</form>
			</ul>
		</div>
	</div>
	<div class="col-sm-9">
		{% if cache %}
			<div class="cache">Displaying cache from {{ cache|timesince }} ago</div>
		{% endif %}
		<table id="stories" class="table table-striped table-hover table-condensed">
			<tbody>
				<thead class="hidden-phone">
					<tr>
						<th>Comments</th>
						<th>Score</th>
						<th>Submission</th>
						<th>Time</th>
					</tr>
				</thead>
				{% for story in stories %}
				<tr>
					<td><a class="comments" href="/comments/{{ story.id }}">{{ story.comments|default:"0" }}</a></td>
					<td><a class="score" href="/comments/{{ story.id }}">{{ story.score|default:"0" }}</a></td>
					{% if story.dead %}
					<td>{{ story.title|safe }} <span class="muted">(dead)</td>
					{% elif story.selfpost %}
					<td><a class="link" href="/comments/{{ story.id }}">{{ story.title|safe }}</a></td>
					{% else %}
					<td><a class="link" href="{{ story.url }}">{{ story.title|safe }}</a> ({{ story.url|domain }})</td>
					{% endif %}
					<td><time title="{{ story.time|date:"r" }}" datetime="{{ story.time}}">{{ story.time|timesince|upto:',' }}</time></td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
		{% if pages|length > 1 %}
		<ul class="pagination pagination-centered">
			{% if stories.number != 1 %}
			<li><a href="{% query_string "page=1" "" %}">&laquo;</a></li>
			{% else %}
			<li class="disabled"><span>&laquo;</span></li>
			{% endif %}

			{% if stories.has_previous %}
			<li><a href="{% query_string "page=stories.previous_page_number" "" %}">&lsaquo;</a></li>
			{% else %}
			<li class="disabled"><span>&lsaquo;</span></li>
			{% endif %}

			{% for page in pages %}
			<li{% if page == stories.number %} class="active" {% endif %}><a href="{% query_string "page=page" "" %}">{{ page }}</a></li>
			{% endfor %}

			{% if stories.has_next %}
			<li><a href="{% query_string "page=stories.next_page_number" "" %}">&rsaquo;</a></li>
			{% else %}
			<li class="disabled"><span>&rsaquo;</span></li>
			{% endif %}

			{% if stories.number != stories.paginator.num_pages %}
			<li><a href="{% query_string "page=stories.paginator.num_pages" "" %}">&raquo;</a></li>
			{% else %}
			<li class="disabled"><span>&raquo;</span></li>
			{% endif %}
		</ul>
	</div>
</div>
{% endif %}
{% endblock %}
